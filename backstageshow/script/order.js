

var demodata=[
    {id:0,name:"陈南康",phone:"15634026055",ordernum:"0102346165625",
        platform:"1",address:"山东省济南市历下区甸柳街道燕柳园门内丰巢快递箱",
        goodslist:[
            {name:"超能小黑中型犬鲜粮250gx14包",number:"1"},
            {name:"自制低盐原味宠物羊奶酪狗零食100g",number:"2"}
        ],
        week:"4",price:"333.33",paytype:"weixin",status:"1",time:"2017/07/23 11:44:21",
        remark:[{
            name:"用户本人",
            time:"2017/08/03 02:23:22",
            content:"啊杀杀杀大撒大青蛙"
        },{
            name:"用户本人",
            time:"2017/08/03 02:23:22",
            content:"草色的大家好还不走之后就的部分"
        }]
    },
    {remark:[{name:"用户本人",time:"2017/08/03 02:23:22",content:"啊杀杀杀大撒大青蛙"}],id:1,name:"陈康",phone:"15634026055",ordernum:"0102346165625",
        platform:"2",address:"山东省济南市历下区甸柳街道燕柳园门内丰巢快递箱",
        goodslist:[
            {name:"超能小黑中型犬鲜粮250gx14包",number:"1"},
            {name:"自制低盐原味宠物羊奶酪狗零食100g",number:"2"}
        ],
        week:"8",price:"333.33",paytype:"weixin",status:"1",time:"2017/07/23 11:44:21"
    },
    {remark:[{name:"用户本人",time:"2017/08/03 02:23:22",content:"啊杀杀杀大撒大青蛙"}],id:2,name:"陈南康",phone:"15634026055",ordernum:"0102346165625",
        platform:"3",address:"山东省济南市历下区甸柳街道燕柳园门内丰巢快递箱",
        goodslist:[
            {name:"超能小黑中型犬鲜粮250gx14包",number:"1"},
            {name:"自制低盐原味宠物羊奶酪狗零食100g",number:"2"},
            {name:"自制低盐原味宠物羊奶酪狗零食100g",number:"2"},
            {name:"超能小黑中型犬鲜粮250gx14包",number:"1"}
        ],
        week:"4",price:"668.33",paytype:"weixin",status:"2",time:"2017/07/23 11:44:21"
    },
    {remark:[{name:"用户本人",time:"2017/08/03 02:23:22",content:"啊杀杀杀大撒大青蛙"}],id:3,name:"陈南康",phone:"15634026055",ordernum:"0102346165625",
        platform:"1",address:"山东省济南市历下区甸柳街道燕柳园门内丰巢快递箱",
        goodslist:[
            {name:"超能小黑中型犬鲜粮250gx14包",number:"1"},
            {name:"自制低盐原味宠物羊奶酪狗零食100g",number:"2"}
        ],
        week:"4",price:"333.33",paytype:"alipay",status:"3",time:"2017/07/23 11:44:21"},
    {remark:[{name:"用户本人",time:"2017/08/03 02:23:22",content:"啊杀杀杀大撒大青蛙"}],id:4,name:"陈南康",phone:"15634026055",ordernum:"0102346165625",
        platform:"1",address:"山东省济南市历下区甸柳街道燕柳园门内丰巢快递箱",
        goodslist:[
            {name:"超能小黑中型犬鲜粮250gx14包",number:"1"},
            {name:"自制低盐原味宠物羊奶酪狗零食100g",number:"2"}
        ],
        week:"4",price:"333.33",paytype:"alipay",status:"4",time:"2017/07/23 11:44:21"},
    {remark:[{name:"用户本人",time:"2017/08/03 02:23:22",content:"啊杀杀杀大撒大青蛙"}],id:5,name:"陈南康",phone:"15634026055",ordernum:"0102346165625",
        platform:"3",address:"山东省济南市历下区甸柳街道燕柳园门内丰巢快递箱",
        goodslist:[
            {name:"超能小黑中型犬鲜粮250gx14包",number:"1"},
            {name:"自制低盐原味宠物羊奶酪狗零食100g",number:"2"}
        ],
        week:"4",price:"333.33",paytype:"weixin",status:"5",time:"2017/07/23 11:44:21"},
    {remark:[{name:"用户本人",time:"2017/08/03 02:23:22",content:"啊杀杀杀大撒大青蛙"}],id:6,name:"陈南康",phone:"15634026055",ordernum:"0102346165625",
        platform:"2",address:"山东省济南市历下区甸柳街道燕柳园门内丰巢快递箱",
        goodslist:[
            {name:"超能小黑中型犬鲜粮250gx14包",number:"1"},
            {name:"自制低盐原味宠物羊奶酪狗零食100g",number:"2"}
        ],
        week:"4",price:"333.33",paytype:"weixin",status:"6",time:"2017/07/23 11:44:21"},
    {remark:[{name:"用户本人",time:"2017/08/03 02:23:22",content:"啊杀杀杀大撒大青蛙"}],id:7,name:"陈南康",phone:"15634026055",ordernum:"0102346165625",
        platform:"2",address:"山东省济南市历下区甸柳街道燕柳园门内丰巢快递箱",
        goodslist:[
            {name:"超能小黑中型犬鲜粮250gx14包",number:"1"},
            {name:"自制低盐原味宠物羊奶酪狗零食100g",number:"2"}
        ],
        week:"4",price:"333.33",paytype:"weixin",status:"7",time:"2017/07/23 11:44:21"},
    {remark:[{name:"用户本人",time:"2017/08/03 02:23:22",content:"啊杀杀杀大撒大青蛙"}],id:8,name:"陈康",phone:"15634026055",ordernum:"0102346165625",
        platform:"2",address:"山东省济南市历下区甸柳丰巢快递箱",
        goodslist:[
            {name:"超能小黑中型犬鲜粮250gx14包",number:"1"},
            {name:"自制低盐原味宠物羊奶酪狗零食100g",number:"2"}
        ],
        week:"4",price:"333.33",paytype:"weixin",status:"8",time:"2017/07/23 11:44:21"},
    {remark:[{name:"用户本人",time:"2017/08/03 02:23:22",content:"啊杀杀杀大撒大青蛙"}],id:9,name:"陈康",phone:"15634026055",ordernum:"0102346165625",
        platform:"1",address:"山东省济南市历下区甸柳街道燕柳园柳街道燕柳园门内丰巢快济南市历递箱",
        goodslist:[
            {name:"超能小黑中型犬鲜粮250gx14包",number:"1"},
            {name:"自制低盐原味宠物羊奶酪狗零食100g",number:"2"}
        ],
        week:"4",price:"333.33",paytype:"weixin",status:"8",time:"2017/07/23 11:44:21"},
    {remark:[],id:10,name:"陈康",phone:"15634026055",ordernum:"0102346165625",
        platform:"1",address:"山东省济南市历下区甸柳街道燕柳园门内丰巢快递箱",
        goodslist:[
            {name:"超能小黑中型犬鲜粮250gx14包",number:"1"},
            {name:"自制低盐原味宠物羊奶酪狗零食100g",number:"2"}
        ],
        week:"4",price:"333.33",paytype:"weixin",status:"8",time:"2017/07/23 11:44:21"},
    {remark:[],id:11,name:"陈康打",phone:"15634026055",ordernum:"0102346165625",
        platform:"3",address:"山东省济南市历下区甸柳街道燕柳园门内丰巢快递箱",
        goodslist:[
            {name:"超能小黑中型犬鲜粮250gx14包",number:"1"},
            {name:"自制低盐原味宠物羊奶酪狗零食100g",number:"2"}
        ],
        week:"4",price:"333.33",paytype:"weixin",status:"8",time:"2017/07/23 11:44:21"}
];   //测试数据

var main =  new Vue({
    el:"#main",
    data:{
        from_limit:[], //来源限制
        status_limit:1,             //状态限制
        lis:[],                     //需要展现的订单
        lis_all:[],                 //现有来源限制下的所有订单
        lis_status_all:[],          //现有来源、状态限制下的所有订单
        lis_done:[],                //已完成的订单
        nowpage:1,                  //现在显示的第几页
        showpages:100,              //一页显示多少条
        nownum:0,                    //现有来源、状态限制下的所有订单个数
        status7_num:0,
        status8_num:0
    },
    computed:{
        Pages:function(){
            return Math.ceil(this.nownum/this.showpages)
        },
        MiddlePages:function(){
            if(this.Pages<6){
                return 0;
            }else{
                if(this.nowpage>3){
                    if(this.Pages-this.nowpage<2){
                        return this.Pages - 5;
                    }else{
                        return this.nowpage-3;
                    }
                }else{
                    return 0;
                }
            }
        },
        Hangs:function(){
            var num = 0;
            for(let i=0;i<this.lis_all.length;i++){
                if(this.lis_all[i].status == 7){
                    num++;
                }
            }
            return num;
        },
        Recovers:function(){
            var num = 0;
            for(let i=0;i<this.lis_all.length;i++){
                if(this.lis_all[i].status == 8){
                    num++;
                }
            }
            return num;
        }
    },
    methods:{
        GetData:function(){
            this.lis=[];
            this.lis_all=[];
            this.lis_status_all=[];
            var m = 0;
            for(let i =0,j=0,k=0;i<demodata.length;i++){
               if(this.from_limit.length==0){
                   Vue.set(this.lis_all, j, demodata[i]);
                   j++;
                   if(this.status_limit == 100){
                       m++;
                       Vue.set(this.lis_status_all, k, demodata[i]);
                       k++;
                   }else if(demodata[i].status == this.status_limit){
                       m++;
                       Vue.set(this.lis_status_all, k, demodata[i]);
                       k++;
                   }
               }else{
                   for(var n =0;n<this.from_limit.length;n++){
                       if(demodata[i].platform == this.from_limit[n]){
                           Vue.set(this.lis_all, j, demodata[i]);
                           j++;
                           if(this.status_limit == 100){
                               m++;
                               Vue.set(this.lis_status_all, k, demodata[i]);
                               k++;
                           }else if(demodata[i].status == this.status_limit){
                               m++;
                               Vue.set(this.lis_status_all, k, demodata[i]);
                               k++;
                           }
                       }
                   }
               }

            }
            this.nownum = m;
            for(let i = (this.nowpage-1)*this.showpages,j=0;i<this.nowpage*this.showpages && i<this.lis_status_all.length;i++){
               if(this.from_limit.length==0){
                       if(this.status_limit == 100){
                           Vue.set(this.lis, j, this.lis_status_all[i]);
                           j++;

                       }else if(this.lis_status_all[i].status == this.status_limit){
                           Vue.set(this.lis, j, this.lis_status_all[i]);
                           j++;
                       }
               }else{
                   for(var n =0;n<this.from_limit.length;n++){
                       if(this.lis_status_all[i].platform == this.from_limit[n]){
                           if(this.status_limit == 100){
                               Vue.set(this.lis, j, this.lis_status_all[i]);
                               j++;

                           }else if(this.lis_status_all[i].status == this.status_limit){
                               Vue.set(this.lis, j, this.lis_status_all[i]);
                               j++;
                           }
                       }
                   }
               }

            }
            var _this =this;
            var keyword = $("#search-content").val();
            var starttime='',endtime='';
            if($("#search-starttime").attr("y")){
                starttime = $("#search-starttime").html();
            }
            if($("#search-endtime").attr("m")){
                endtime =$("#search-endtime").html();
            }
            var key;
            if(starttime && endtime){
                if(endtime>=starttime){
                    key = true;
                }else{
                    alert("结束时间必须大于等于开始时间!")
                    return;
                }
            }else if(starttime &&!endtime){
                var date = new Date();
                endtime = date.getFullYear()+"/"+parseInt(date.getMonth()+1)+"/"+parseInt(date.getDate());
                if(endtime>=starttime){
                    key =true;
                }else{
                    alert("开始时间必须小于当前时间！");
                }
            }else if(!starttime && endtime){
                starttime = "2015/01/01 00:00:00";
                key =true;
            }else{
                key = true;
            }
            var platform =[];
            if(this.from_limit.length==0){
                platform = ['1','2','3'];
            }else{
                platform = this.from_limit;
            }
            platform = platform.join(",");
            if(key){
                $.ajax({
                    url:"",
                    // type:"POST",
                    beforeSend:function(){
                        $("#wait_img").addClass("active");
                    },
                    complete:function(){
                        $("#wait_img").removeClass("active");
                    },
                    timeout:100,
                    data:{
                        userid:localStorage.userid,
                        token:localStorage.token,
                        keyword:keyword,
                        starttime:starttime,
                        endtime:endtime,
                        platform:platform,
                        status:this.status_limit,
                        nowpage:this.nowpage,
                        showpages:this.showpages
                    },
                    // dataType:'json',
                    success:function(e){
                        // if(!Token(e)){
                        //
                        // }else{
                        //     if(e){
                        //         if(e.nownum){
                        //             _this.nownum  = e.nownum;
                        //         }
                        //         if(e.list ==0){
                        //             _this.lis = [];
                        //         }else{
                        //             _this.lis = e.list;
                        //         }
                        //         if(this.nowpage>this.Pages){
                        //             this.nowpage=1;
                        //         }
                        //     }
                        //     _this.status8_num = e.status8_num;
                        //     _this.status7_num = e.status7_num;
                        // }

                    },
                    error:function(e){
                        console.log(e)
                        alert("网络连接错误！")
                    }
                });

            }

        },
        PageMenu:function(){
            $("#paging .menu").addClass("active");
            $("#paging .menu [data-page="+this.showpages+"]").addClass("active");
        },
        ChangeShowPages:function(){
            event.stopPropagation();
            if(!$(event.target).hasClass("nowpage")){
                $("#paging .menu").removeClass("active");
                $(event.target).addClass("active").siblings().removeClass("active");
                this.showpages = parseInt($(event.target).attr("data-page"));
                this.nowpage = 1;
                this.GetData();
            }else{
                $("#paging .menu").removeClass("active");
            }
        },
        NowPage:function(){
            this.nowpage = parseInt($(event.target).html());
            this.GetData();
        },
        ChangeFrom:function(e){
            var that;
            if($(event.target).attr("data-from")){
                that = $(event.target);
            }else{
                that = $(event.target).parent("div");
            }
            if(that.hasClass("btn-all")){
                this.from_limit = [];
                that.addClass("active").siblings().removeClass("active");
            }else{
                if(!that.hasClass("active")){
                    if(that.siblings(".btn-all").hasClass("active")){
                        this.from_limit = [that.attr("data-from")];
                        that.siblings(".btn-all").removeClass("active");
                    }else{
                        this.from_limit.push(that.attr("data-from"))
                    }
                    that.addClass("active");
                }else{
                    that.removeClass("active");
                    for(var i =0;i<this.from_limit.length;i++){
                        if(this.from_limit[i] == that.attr("data-from")){
                            this.from_limit.splice(i,1);
                        }
                    }
                }
            }
            this.nowpage =1;
            this.GetData();
        },
        ChangeStatus:function(){
            var that = $(event.target).parents(".status-btn");
            if(!that.hasClass("active")){
                that.addClass("active").siblings().removeClass("active");
                this.status_limit = that.attr("data-status");
                this.GetData();
            }

        },
        PrePage:function(){
            if(this.nowpage>1){
                this.nowpage--;
                this.GetData();
            }
        },
        NextPage:function(){
            if(this.nowpage<this.Pages){
                this.nowpage++;
                this.GetData();
            }
        },
        LastPage:function(){
            if(this.nowpage<this.Pages){
                this.nowpage = this.Pages;
                this.GetData();
            }
        },
        FirstPage:function(){
            if(this.nowpage>1){
                this.nowpage = 1;
                this.GetData();
            }
        }

    },
    components:{
        "li-order":{
            props:["to",'index'],
            template:'<li>' +
            '<order-status :status="to.status"></order-status>' +
            '<number :number="to.ordernum" :status="to.status"></number>'+
            '<user :name=to.username :phone=to.phone :platform=to.platform  :address=to.address></user>'+
            '<goods :list=to.goodslist></goods>'+
            '<cycle :week=to.week></cycle>'+
            '<money :price=to.price :paytype=to.paytype></money>'+
            '<times :time="to.time"></times>'+
            '<remarks :to=to.remark :id=to.id :week=to.week :index=index></remarks>'+
            '<checks :id=to.id></checks>'+
            '</li>',
            components:{
                "order-status":{
                    props:["status"],
                    template: '<div class="order-status" :class="{no_pay:status == 2,done:status ==4,red:status == 3||status == 5||status == 7||status == 8,gray:status == 6 }"></div>'
                },
                "number":{
                    props:["number","status"],
                    template:'<div class="number">'+
                        '<div>'+
                        '<span>#{{number}}</span>' +
                        '<div v-if="status == 1">' +
                        '<img src="../../image/pay_icon@20px.png">'+
                        '<p>已付款</p>'+
                        '</div>'+
                        '<div v-else-if="status == 3">' +
                        '<img src="../../image/pause@20px.png">'+
                        '<p class="red">暂停中</p>'+
                        '</div>'+
                        '<div v-else-if="status == 2">' +
                        '<img src="../../image/unpaid_icon@20px.png">'+
                        '<p>未付款</p>'+
                        '</div>'+
                        '<div v-else-if="status == 4">' +
                        '<img src="../../image/Done@20px.png">'+
                        '<p >已完成</p>'+
                        '</div>'+
                        '<div v-else-if="status == 5">' +
                        '<img src="../../image/refunding_icon@20px.png">'+
                        '<p class="red">退款中</p>'+
                        '</div>'+
                        '<div v-else-if="status == 6">' +
                        '<img src="../../image/refunds_icon@20px.png">'+
                        '<p>已退款</p>'+
                        '</div>'+
                        '<div v-else-if="status == 7">' +
                        '<img src="../../image/warning_icon@20px.png">'+
                        '<p class="red">挂起中</p>'+
                        '</div>'+
                        '<div v-else-if="status == 8">' +
                        '<img src="../../image/recover_icon@20px.png">'+
                        '<p class="red">追回中</p>'+
                        '</div>'+
                        '</div>'+
                        '</div>'
                },
                "user":{
                    props:["name","phone","platform","address"],
                    template:'<div class="user">' +
                        '<div>'+
                        '<div>'+
                        '<p class="name">{{name}}</p>'+
                        '<p class="phone">{{phone}}</p>'+
                        '<p class="from"  v-if="platform == 1">淘宝</p>'+
                        '<p class="from"  v-else-if="platform == 2">App</p>'+
                        '<p class="from"  v-else-if="platform == 3">微信</p>'+
                        '</div>'+
                        '<div class="address-wrap">'+
                        '<p class="address">{{address}}</p>'+
                        '</div>'+
                        '</div>'+
                        '</div>'
                },
                "goods":{
                    props:["list"],
                    template:'<div class="goods" v-bind:class="{ more:list.length>2}">'+
                    '<div v-for="(data,index) in list" v-if="index<2">'+
                    '<p class="goodsname">{{data.name}}</p>'+
                    '<p class="goodsnum">X{{data.number}}</p>'+
                    '</div>'+
                    '<div class="menu">'+
                        '<div v-for="(data,index) in list">'+
                            '<p class="goodsname">{{data.name}}</p>'+
                            '<p class="goodsnum">X{{data.number}}</p>'+
                        '</div>'+
                    '</div>'+
                    '</div>'
                },
                "cycle":{
                    props:["week"],
                    template:'<div class="cycle">{{week}}周</div>'
                },
                "money":{
                    props:["price","paytype"],
                    template:'<div class="money">'+
                            '<p>￥{{price}}</p>'+
                            '<p class="money-type">{{paytype}}</p>'+
                            '</div>'
                },
                "status":{
                    props:["status"],
                    template:
                             '<div v-if="status==1" class="status">已付款</div>'+
                             '<div v-else-if="status==2" class="status">未付款</div>'+
                             '<div v-else-if="status==3" class="status red">暂停中</div>'+
                             '<div v-else-if="status==4" class="status">已完成</div>'+
                             '<div v-else-if="status==5" class="status red">退款中</div>'+
                             '<div v-else-if="status==6" class="status red">已退款</div>'+
                             '<div v-else-if="status==7" class="status hang"><img src="../../image/warning.png" alt=""/><p>计划挂起</p></div>'+
                             '<div v-else-if="status==8" class="status recover"><img src="../../image/warning.png" alt=""/><p>计划<span>追回</span></p></div>'
                },
                "times":{
                    props:["time"],
                    template:'<div class="times">'+
                                    '<p>{{time.split(" ")[0]}}</p>'+
                                '<p>{{time.split(" ")[1]}}</p>'+
                                '</div>'
                },
                "remarks":{
                    methods:{
                        Remark:function(e){
                            remarks_pop.lis = this.to;
                            if($("#remarks-pop").position().top == this.$el.offsetTop+20 ){
                                $("#remarks-pop").removeClass("active");
                            }else{
                                $("#remarks-pop").addClass("active").css({"left":this.$el.offsetLeft-580,"top":this.$el.offsetTop+20});
                                remarks_pop.id=this.id;
                                remarks_pop.index = this.index;
                                remarks_pop.week = this.week;
                                if(e ==1){
                                    remarks_pop.show = false;
                                }else{
                                    remarks_pop.show = true;
                                }
                            }
                            event.stopPropagation();
                        }
                    },
                    props:["to","id","week",'index'],
                    template:'<div class="remarks">'+
                                '<div v-if="to.length==0" @click ="Remark(1)">'+
                                '<p>备注</p>'+
                                '</div>'+
                                '<img @click ="Remark(0)" @mouseover="Remark(0)" v-else src="../../image/news.png" alt=""/>'+
                                '</div>'
                },
                "checks":{
                    props:['id'],
                    template:'<div class="check">'+
                                '<div @click = "Link(id)">'+
                                '<p>查看</p>'+
                                '</div>'+
                                '</div>',
                    methods:{
                        Link:function(data){
                            location.href="order-detail.html?id="+data;
                        }
                    }
                }
            }
        }
    }

});

$(function(){
    function getParamer(paramer){
        var url=window.location.href.split("?")[1];            /*获取url里"?"后面的值*/

        if(url.indexOf("&")>0){                                      /*判断是否是一个参数还是多个参数*/
            var urlParamArry=url.split("&");                            /*分开每个参数，并放到数组里*/
            for(var i=0; i<urlParamArry.length; i++){
                var paramerName=urlParamArry[i].split("=");   /*把每个参数名和值分开，并放到数组里*/
                if(paramer==paramerName[0]){                     /*匹配输入的参数和数组循环出来的参数是否一样*/
                    return paramerName[1];                           /*返回想要的参数值*/
                }
            }
        }else{                                                              /*判断只有个参数*/
            var paramerValue=url.split("=")[1];
            return paramerValue;
        }
    }
    if(window.location.href.split("?")[1]){
        var st = getParamer('st');
        var et = getParamer('et');
        var status= getParamer('status');
        $("#search-content").val(decodeURI(getParamer('wd')));
        if(st){
            $("#search-starttime").html(st).attr({"y":st.split("/")[0],"m":st.split("/")[1],"d":st.split("/")[2]});
        }
        if(et){
            $("#search-endtime").html(et).attr({"y":et.split("/")[0],"m":et.split("/")[1],"d":et.split("/")[2]});
        }
        var list = $("#order-status>div");
        if(status !=100){
            for(var i =0;i<list.length;i++){
                if(list.eq(i).attr("data-status") !=status){
                    list.eq(i).css("display","none");
                }else{
                    list.eq(i).css("display","block");
                    list.eq(i).addClass("active").siblings().removeClass("active");
                }
            }

            $("#search-status>p").html($("#search-status .menu>li").eq(parseInt(status-1)).find("p").html());
            $("#search-status .menu>li").eq(parseInt(status-1)).addClass("active").siblings().removeClass("active");
        }else{
            list.css("display","block");
            list.eq(list.length-1).addClass("active").siblings().removeClass("active");
        }
        Vue.set(main,'status_limit',status);

    }
    main.GetData();

});
var remarks_pop =new Vue({
    el:"#remarks-pop",
    data:{
        lis:[],
        week:4,
        id:2,
        index:1,
        show:true,
        select_week:[],
        remark_content:""
    },
    computed:{
        remark_week:function(){
            var data="";
            if(this.select_week.length>0){
                for(var i =0;i<this.select_week.length;i++){
                    if(i ==0){
                        data +=this.select_week[i]+"/"+this.week
                    }else{
                        data +=","+this.select_week[i]+"/"+this.week
                    }
                }
            }else{
                data ="订单";
            }
            return data;
        }
    },
    methods:{
        OpenRemark:function(){
            this.show = false;
            event.stopPropagation();
            remarks_pop.select_week=[];
            this.remark_content="";
        },
        OpenRemarks:function(){
            remarks_pop.show = true;
            event.stopPropagation();
            remarks_pop.select_week=[];
            this.remark_content="";
        },
        RemarkWeek:function(){
            $("#remarks-weeks").slideToggle(200);
            event.stopPropagation();
        },
        RemarkCancel:function(){
            $("#remarks-weeks").slideUp(200);
            $("#remarks-weeks-content>div").removeClass("active");
            this.select_week=[];
            this.remark_content="";
        },
        StopEvent:function(){
            event.stopPropagation();
        },
        WeekSelect:function(){
            this.StopEvent();
            var _this;
            if($(event.target).hasClass("week")){
                _this = $(event.target)
            }else{
                _this = $(event.target).parent(".week");
            }
            if(_this.hasClass("active")){
                _this.removeClass("active");
                for(var i in this.select_week){
                    if(this.select_week[i] == _this.attr("data-week")){
                        this.select_week.splice(i,1)
                    }
                }
                $("#remarks-weeks-bottom .allselect").removeClass("active");
            }else{
                _this.addClass("active");
                this.select_week.push(_this.attr("data-week"));
                if(this.select_week.length == this.week){
                    $("#remarks-weeks-bottom .allselect").addClass("active");
                }

            }
        },
        AllSelect:function(){
            var _this;
            if($(event.target).hasClass("allselect")){
                _this = $(event.target)
            }else{
                _this = $(event.target).parent(".allselect");
            }
            if(_this.hasClass("active")){
                if(this.select_week.length == this.week){
                    _this.removeClass("active");
                    $("#remarks-weeks-content .week").removeClass("active");
                }
            }else{
                this.select_week = [];
                for(var i=0;i<this.week;i++){
                    this.select_week.push(i+1);
                }
                $("#remarks-weeks-content .week").addClass("active");
                _this.addClass("active");
            }
        },
        SubmitRemark:function(){
            if(this.remark_content.length>0){
                var weeks="";
                if(this.select_week.length>0){
                    weeks = this.select_week.join(",");
                }
                $.ajax({
                    url:"",
                    // type:"POST",
                    beforeSend:function(){
                        $("#wait_img").addClass("active");
                    },
                    complete:function(){
                        $("#wait_img").removeClass("active");
                    },
                    timeout:10000,
                    data:{
                        userid:localStorage.userid,
                        token:localStorage.token,
                        content:this.remark_content,
                        weeks:weeks,
                        orderid:this.id
                    },
                    dataType:"json",
                    success:function(e){
                        if(!Token(e)){
                            $("#remarks-pop").removeClass("active");
                        }else{
                            alert("备注成功！");
                            if(weeks ==''){
                                var remark = {
                                    name:localStorage.nickname,
                                    time:e.date,
                                    content:remarks_pop.remark_content
                                };
                                main.lis[remarks_pop.index].remark.push(remark);
                            }
                            $("#remarks-pop").removeClass("active");
                        }
                    },
                    error:function(e){
                        console.log(e);
                        alert("网络链接错误!")
                    }
                })
            }else{
                alert("请输入备注内容!")
            }


        }
    }
});



//====================搜索栏

//搜索栏状态菜单弹出
$("#search-status").on("click",function(){
    event.stopPropagation();
    $(this).children(".menu").addClass("active");
});

//搜索栏状态选择
$("#search-status>.menu>li").on("click",function(){
    event.stopPropagation();
    var status = $(this).attr("data-status");
    $(this).addClass("active").siblings().removeClass("active");
    $("#search-status>p").html($(this).find("p").html());
    $("#search-status").attr("data-status",status);
    $("#search-status>.menu").removeClass("active");
    var list = $("#order-status>div");
    main.status_limit = status;
    if(status !=100){
        for(var i =0;i<list.length;i++){
            if(list.eq(i).attr("data-status") !=status){
                list.eq(i).css("display","none");
            }else{
                list.eq(i).css("display","block");
                list.eq(i).addClass("active").siblings().removeClass("active");
            }
        }
    }else{
        list.css("display","block");
        list.eq(list.length-1).addClass("active").siblings().removeClass("active");
    }
});

$("#search-btn").on("click",function(){
    main.GetData();
});

$(window).on("click",function(){
    if($("#remarks-pop").hasClass("active")){
        $("#remarks-pop").removeClass("active");

    }
    if($("#select-date").hasClass("active")){
        $("#select-date").slideUp(0).removeClass("active");
        $("[time=active]").attr("time","");
    }
    if($("#search-status .menu").hasClass("active")){
        $("#search-status .menu").removeClass("active");
    }
});

$(function(){
    $("#search-starttime").on("click",function(){
        var data={
            that:$(this),
            position:"bottom",
            y:$(this).attr("y"),
            m:$(this).attr("m"),
            d:$(this).attr("d")
        };
        TimeShow(data);
    });
    $("#search-endtime").on("click",function(){
        var data={
            that:$(this),
            position:"bottom",
            y:$(this).attr("y"),
            m:$(this).attr("m"),
            d:$(this).attr("d")
        };
        TimeShow(data);
    });
})
